{
  "openapi": "3.1.0",
  "info": {
    "title": "D&D Battle Manager API",
    "version": "1.0.0",
    "description": "Type-safe API for D&D 5e battle management with MCP support"
  },
  "servers": [
    {
      "url": "http://localhost:8000",
      "description": "Local development server"
    }
  ],
  "components": {
    "schemas": {},
    "parameters": {}
  },
  "paths": {
    "/api/dice/roll": {
      "post": {
        "tags": [
          "dice",
          "mcp"
        ],
        "summary": "Roll dice",
        "description": "Roll dice using standard notation (e.g., 2d6+3)",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "notation": {
                    "type": "string",
                    "example": "2d6+3",
                    "description": "Dice roll expression (e.g., 2d6+3, 1d20, 2d20kh1)"
                  },
                  "modifier": {
                    "type": "number",
                    "default": 0,
                    "example": 0,
                    "description": "Additional modifier to add to the roll"
                  },
                  "description": {
                    "type": "string",
                    "example": "Attack roll",
                    "description": "Optional description for the roll"
                  }
                },
                "required": [
                  "notation"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Dice roll successful",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "string",
                      "example": "550e8400-e29b-41d4-a716-446655440000"
                    },
                    "notation": {
                      "type": "string",
                      "example": "2d6+3"
                    },
                    "rolls": {
                      "type": "array",
                      "items": {
                        "type": "number"
                      },
                      "example": [
                        6,
                        6
                      ]
                    },
                    "total": {
                      "type": "number",
                      "example": 15
                    },
                    "modifier": {
                      "type": "number",
                      "example": 3
                    },
                    "description": {
                      "type": "string",
                      "example": "Attack roll"
                    },
                    "timestamp": {
                      "type": "number",
                      "example": 1634567890000
                    }
                  },
                  "required": [
                    "id",
                    "notation",
                    "rolls",
                    "total",
                    "modifier",
                    "timestamp"
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Invalid dice expression",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "Invalid dice expression"
                    }
                  },
                  "required": [
                    "error"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/battles": {
      "get": {
        "tags": [
          "battle",
          "mcp"
        ],
        "summary": "List all battles",
        "description": "Get a list of all battles with their summaries",
        "responses": {
          "200": {
            "description": "List of all battles",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "enum": [
                        true
                      ]
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string"
                          },
                          "name": {
                            "type": "string"
                          },
                          "mode": {
                            "type": "string",
                            "enum": [
                              "TheatreOfMind",
                              "GridBased"
                            ]
                          },
                          "creatureCount": {
                            "type": "integer",
                            "minimum": 0
                          },
                          "status": {
                            "type": "string",
                            "enum": [
                              "active",
                              "inactive"
                            ]
                          }
                        },
                        "required": [
                          "id",
                          "name",
                          "mode",
                          "creatureCount",
                          "status"
                        ]
                      }
                    }
                  },
                  "required": [
                    "success",
                    "data"
                  ]
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "battle",
          "mcp"
        ],
        "summary": "Create a new battle",
        "description": "Create a new battle with the specified name and configuration",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "minLength": 1,
                    "example": "Goblin Ambush"
                  },
                  "mode": {
                    "type": "string",
                    "enum": [
                      "TheatreOfMind",
                      "GridBased"
                    ],
                    "default": "TheatreOfMind"
                  },
                  "mapSize": {
                    "type": "object",
                    "properties": {
                      "width": {
                        "type": "integer",
                        "exclusiveMinimum": 0
                      },
                      "height": {
                        "type": "integer",
                        "exclusiveMinimum": 0
                      }
                    },
                    "required": [
                      "width",
                      "height"
                    ]
                  },
                  "sceneDescription": {
                    "type": "string",
                    "example": "A dark forest path where goblins lie in wait"
                  }
                },
                "required": [
                  "name"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Battle created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "enum": [
                        true
                      ]
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        },
                        "creatures": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "name": {
                                "type": "string"
                              },
                              "hp": {
                                "type": "integer"
                              },
                              "maxHp": {
                                "type": "integer",
                                "exclusiveMinimum": 0
                              },
                              "ac": {
                                "type": "integer",
                                "minimum": 0
                              },
                              "initiative": {
                                "type": "integer"
                              },
                              "stats": {
                                "type": "object",
                                "properties": {
                                  "str": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "dex": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "con": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "int": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "wis": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "cha": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  }
                                },
                                "required": [
                                  "str",
                                  "dex",
                                  "con",
                                  "int",
                                  "wis",
                                  "cha"
                                ]
                              },
                              "statusEffects": {
                                "type": "array",
                                "items": {
                                  "type": "object",
                                  "properties": {
                                    "name": {
                                      "type": "string"
                                    },
                                    "description": {
                                      "type": "string"
                                    },
                                    "duration": {
                                      "type": "number"
                                    },
                                    "concentration": {
                                      "type": "boolean"
                                    }
                                  },
                                  "required": [
                                    "name"
                                  ]
                                }
                              },
                              "position": {
                                "type": "object",
                                "properties": {
                                  "x": {
                                    "type": "integer",
                                    "minimum": 0,
                                    "example": 5
                                  },
                                  "y": {
                                    "type": "integer",
                                    "minimum": 0,
                                    "example": 3
                                  }
                                },
                                "required": [
                                  "x",
                                  "y"
                                ]
                              },
                              "size": {
                                "type": "string",
                                "enum": [
                                  "Tiny",
                                  "Small",
                                  "Medium",
                                  "Large",
                                  "Huge",
                                  "Gargantuan"
                                ]
                              },
                              "isPlayer": {
                                "type": "boolean"
                              }
                            },
                            "required": [
                              "id",
                              "name",
                              "hp",
                              "maxHp",
                              "ac",
                              "initiative",
                              "stats",
                              "statusEffects",
                              "size",
                              "isPlayer"
                            ]
                          }
                        },
                        "currentTurn": {
                          "type": "integer",
                          "minimum": 0
                        },
                        "round": {
                          "type": "integer",
                          "minimum": 0
                        },
                        "isActive": {
                          "type": "boolean"
                        },
                        "history": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "timestamp": {
                                "type": "number"
                              },
                              "type": {
                                "type": "string"
                              },
                              "data": {},
                              "previousState": {}
                            },
                            "required": [
                              "id",
                              "timestamp",
                              "type"
                            ]
                          }
                        },
                        "mode": {
                          "type": "string",
                          "enum": [
                            "TheatreOfMind",
                            "GridBased"
                          ]
                        },
                        "map": {
                          "type": "object",
                          "properties": {
                            "width": {
                              "type": "integer",
                              "exclusiveMinimum": 0
                            },
                            "height": {
                              "type": "integer",
                              "exclusiveMinimum": 0
                            },
                            "cells": {
                              "type": "array",
                              "items": {
                                "type": "array",
                                "items": {
                                  "type": "object",
                                  "properties": {
                                    "x": {
                                      "type": "integer",
                                      "minimum": 0
                                    },
                                    "y": {
                                      "type": "integer",
                                      "minimum": 0
                                    },
                                    "terrain": {
                                      "type": "string",
                                      "enum": [
                                        "Empty",
                                        "Wall",
                                        "DifficultTerrain",
                                        "Water",
                                        "Pit",
                                        "Door",
                                        "Window",
                                        "Cover",
                                        "HeavyCover",
                                        "Stairs",
                                        "Hazard"
                                      ]
                                    },
                                    "doorOpen": {
                                      "type": "boolean"
                                    },
                                    "elevation": {
                                      "type": "number"
                                    },
                                    "hazardDamage": {
                                      "type": "number"
                                    }
                                  },
                                  "required": [
                                    "x",
                                    "y",
                                    "terrain"
                                  ]
                                }
                              }
                            },
                            "description": {
                              "type": "string"
                            }
                          },
                          "required": [
                            "width",
                            "height",
                            "cells"
                          ]
                        },
                        "sceneDescription": {
                          "type": "string"
                        },
                        "creaturePositions": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "name",
                        "creatures",
                        "currentTurn",
                        "round",
                        "isActive",
                        "history",
                        "mode"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data"
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "enum": [
                        false
                      ]
                    },
                    "error": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "success",
                    "error"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/battles/{id}": {
      "get": {
        "tags": [
          "battle",
          "mcp"
        ],
        "summary": "Get battle details",
        "description": "Get detailed information about a specific battle",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "example": "battle-123"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Battle details",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "enum": [
                        true
                      ]
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        },
                        "creatures": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "name": {
                                "type": "string"
                              },
                              "hp": {
                                "type": "integer"
                              },
                              "maxHp": {
                                "type": "integer",
                                "exclusiveMinimum": 0
                              },
                              "ac": {
                                "type": "integer",
                                "minimum": 0
                              },
                              "initiative": {
                                "type": "integer"
                              },
                              "stats": {
                                "type": "object",
                                "properties": {
                                  "str": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "dex": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "con": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "int": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "wis": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "cha": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  }
                                },
                                "required": [
                                  "str",
                                  "dex",
                                  "con",
                                  "int",
                                  "wis",
                                  "cha"
                                ]
                              },
                              "statusEffects": {
                                "type": "array",
                                "items": {
                                  "type": "object",
                                  "properties": {
                                    "name": {
                                      "type": "string"
                                    },
                                    "description": {
                                      "type": "string"
                                    },
                                    "duration": {
                                      "type": "number"
                                    },
                                    "concentration": {
                                      "type": "boolean"
                                    }
                                  },
                                  "required": [
                                    "name"
                                  ]
                                }
                              },
                              "position": {
                                "type": "object",
                                "properties": {
                                  "x": {
                                    "type": "integer",
                                    "minimum": 0,
                                    "example": 5
                                  },
                                  "y": {
                                    "type": "integer",
                                    "minimum": 0,
                                    "example": 3
                                  }
                                },
                                "required": [
                                  "x",
                                  "y"
                                ]
                              },
                              "size": {
                                "type": "string",
                                "enum": [
                                  "Tiny",
                                  "Small",
                                  "Medium",
                                  "Large",
                                  "Huge",
                                  "Gargantuan"
                                ]
                              },
                              "isPlayer": {
                                "type": "boolean"
                              }
                            },
                            "required": [
                              "id",
                              "name",
                              "hp",
                              "maxHp",
                              "ac",
                              "initiative",
                              "stats",
                              "statusEffects",
                              "size",
                              "isPlayer"
                            ]
                          }
                        },
                        "currentTurn": {
                          "type": "integer",
                          "minimum": 0
                        },
                        "round": {
                          "type": "integer",
                          "minimum": 0
                        },
                        "isActive": {
                          "type": "boolean"
                        },
                        "history": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "timestamp": {
                                "type": "number"
                              },
                              "type": {
                                "type": "string"
                              },
                              "data": {},
                              "previousState": {}
                            },
                            "required": [
                              "id",
                              "timestamp",
                              "type"
                            ]
                          }
                        },
                        "mode": {
                          "type": "string",
                          "enum": [
                            "TheatreOfMind",
                            "GridBased"
                          ]
                        },
                        "map": {
                          "type": "object",
                          "properties": {
                            "width": {
                              "type": "integer",
                              "exclusiveMinimum": 0
                            },
                            "height": {
                              "type": "integer",
                              "exclusiveMinimum": 0
                            },
                            "cells": {
                              "type": "array",
                              "items": {
                                "type": "array",
                                "items": {
                                  "type": "object",
                                  "properties": {
                                    "x": {
                                      "type": "integer",
                                      "minimum": 0
                                    },
                                    "y": {
                                      "type": "integer",
                                      "minimum": 0
                                    },
                                    "terrain": {
                                      "type": "string",
                                      "enum": [
                                        "Empty",
                                        "Wall",
                                        "DifficultTerrain",
                                        "Water",
                                        "Pit",
                                        "Door",
                                        "Window",
                                        "Cover",
                                        "HeavyCover",
                                        "Stairs",
                                        "Hazard"
                                      ]
                                    },
                                    "doorOpen": {
                                      "type": "boolean"
                                    },
                                    "elevation": {
                                      "type": "number"
                                    },
                                    "hazardDamage": {
                                      "type": "number"
                                    }
                                  },
                                  "required": [
                                    "x",
                                    "y",
                                    "terrain"
                                  ]
                                }
                              }
                            },
                            "description": {
                              "type": "string"
                            }
                          },
                          "required": [
                            "width",
                            "height",
                            "cells"
                          ]
                        },
                        "sceneDescription": {
                          "type": "string"
                        },
                        "creaturePositions": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "name",
                        "creatures",
                        "currentTurn",
                        "round",
                        "isActive",
                        "history",
                        "mode"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data"
                  ]
                }
              }
            }
          },
          "404": {
            "description": "Battle not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "enum": [
                        false
                      ]
                    },
                    "error": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "success",
                    "error"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/battles/{id}/creatures": {
      "post": {
        "tags": [
          "battle",
          "mcp"
        ],
        "summary": "Add creature to battle",
        "description": "Add a new creature to an existing battle",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "example": "battle-123"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "minLength": 1,
                    "example": "Goblin Warrior"
                  },
                  "hp": {
                    "type": "integer",
                    "exclusiveMinimum": 0,
                    "example": 7
                  },
                  "maxHp": {
                    "type": "integer",
                    "exclusiveMinimum": 0,
                    "example": 7
                  },
                  "ac": {
                    "type": "integer",
                    "minimum": 0,
                    "default": 10,
                    "example": 15
                  },
                  "initiative": {
                    "type": "integer",
                    "default": 0,
                    "example": 12
                  },
                  "stats": {
                    "type": "object",
                    "properties": {
                      "str": {
                        "type": "integer",
                        "minimum": 1,
                        "maximum": 30
                      },
                      "dex": {
                        "type": "integer",
                        "minimum": 1,
                        "maximum": 30
                      },
                      "con": {
                        "type": "integer",
                        "minimum": 1,
                        "maximum": 30
                      },
                      "int": {
                        "type": "integer",
                        "minimum": 1,
                        "maximum": 30
                      },
                      "wis": {
                        "type": "integer",
                        "minimum": 1,
                        "maximum": 30
                      },
                      "cha": {
                        "type": "integer",
                        "minimum": 1,
                        "maximum": 30
                      }
                    },
                    "default": {
                      "str": 10,
                      "dex": 10,
                      "con": 10,
                      "int": 10,
                      "wis": 10,
                      "cha": 10
                    },
                    "required": [
                      "str",
                      "dex",
                      "con",
                      "int",
                      "wis",
                      "cha"
                    ]
                  },
                  "statusEffects": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string"
                        },
                        "description": {
                          "type": "string"
                        },
                        "duration": {
                          "type": "number"
                        },
                        "concentration": {
                          "type": "boolean"
                        }
                      },
                      "required": [
                        "name"
                      ]
                    },
                    "default": []
                  },
                  "position": {
                    "type": "object",
                    "properties": {
                      "x": {
                        "type": "integer",
                        "minimum": 0,
                        "example": 5
                      },
                      "y": {
                        "type": "integer",
                        "minimum": 0,
                        "example": 3
                      }
                    },
                    "required": [
                      "x",
                      "y"
                    ]
                  },
                  "size": {
                    "type": "string",
                    "enum": [
                      "Tiny",
                      "Small",
                      "Medium",
                      "Large",
                      "Huge",
                      "Gargantuan"
                    ],
                    "default": "Medium"
                  },
                  "isPlayer": {
                    "type": "boolean",
                    "default": false
                  }
                },
                "required": [
                  "name",
                  "hp",
                  "maxHp"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Creature added successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "enum": [
                        true
                      ]
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        },
                        "creatures": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "name": {
                                "type": "string"
                              },
                              "hp": {
                                "type": "integer"
                              },
                              "maxHp": {
                                "type": "integer",
                                "exclusiveMinimum": 0
                              },
                              "ac": {
                                "type": "integer",
                                "minimum": 0
                              },
                              "initiative": {
                                "type": "integer"
                              },
                              "stats": {
                                "type": "object",
                                "properties": {
                                  "str": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "dex": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "con": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "int": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "wis": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "cha": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  }
                                },
                                "required": [
                                  "str",
                                  "dex",
                                  "con",
                                  "int",
                                  "wis",
                                  "cha"
                                ]
                              },
                              "statusEffects": {
                                "type": "array",
                                "items": {
                                  "type": "object",
                                  "properties": {
                                    "name": {
                                      "type": "string"
                                    },
                                    "description": {
                                      "type": "string"
                                    },
                                    "duration": {
                                      "type": "number"
                                    },
                                    "concentration": {
                                      "type": "boolean"
                                    }
                                  },
                                  "required": [
                                    "name"
                                  ]
                                }
                              },
                              "position": {
                                "type": "object",
                                "properties": {
                                  "x": {
                                    "type": "integer",
                                    "minimum": 0,
                                    "example": 5
                                  },
                                  "y": {
                                    "type": "integer",
                                    "minimum": 0,
                                    "example": 3
                                  }
                                },
                                "required": [
                                  "x",
                                  "y"
                                ]
                              },
                              "size": {
                                "type": "string",
                                "enum": [
                                  "Tiny",
                                  "Small",
                                  "Medium",
                                  "Large",
                                  "Huge",
                                  "Gargantuan"
                                ]
                              },
                              "isPlayer": {
                                "type": "boolean"
                              }
                            },
                            "required": [
                              "id",
                              "name",
                              "hp",
                              "maxHp",
                              "ac",
                              "initiative",
                              "stats",
                              "statusEffects",
                              "size",
                              "isPlayer"
                            ]
                          }
                        },
                        "currentTurn": {
                          "type": "integer",
                          "minimum": 0
                        },
                        "round": {
                          "type": "integer",
                          "minimum": 0
                        },
                        "isActive": {
                          "type": "boolean"
                        },
                        "history": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "timestamp": {
                                "type": "number"
                              },
                              "type": {
                                "type": "string"
                              },
                              "data": {},
                              "previousState": {}
                            },
                            "required": [
                              "id",
                              "timestamp",
                              "type"
                            ]
                          }
                        },
                        "mode": {
                          "type": "string",
                          "enum": [
                            "TheatreOfMind",
                            "GridBased"
                          ]
                        },
                        "map": {
                          "type": "object",
                          "properties": {
                            "width": {
                              "type": "integer",
                              "exclusiveMinimum": 0
                            },
                            "height": {
                              "type": "integer",
                              "exclusiveMinimum": 0
                            },
                            "cells": {
                              "type": "array",
                              "items": {
                                "type": "array",
                                "items": {
                                  "type": "object",
                                  "properties": {
                                    "x": {
                                      "type": "integer",
                                      "minimum": 0
                                    },
                                    "y": {
                                      "type": "integer",
                                      "minimum": 0
                                    },
                                    "terrain": {
                                      "type": "string",
                                      "enum": [
                                        "Empty",
                                        "Wall",
                                        "DifficultTerrain",
                                        "Water",
                                        "Pit",
                                        "Door",
                                        "Window",
                                        "Cover",
                                        "HeavyCover",
                                        "Stairs",
                                        "Hazard"
                                      ]
                                    },
                                    "doorOpen": {
                                      "type": "boolean"
                                    },
                                    "elevation": {
                                      "type": "number"
                                    },
                                    "hazardDamage": {
                                      "type": "number"
                                    }
                                  },
                                  "required": [
                                    "x",
                                    "y",
                                    "terrain"
                                  ]
                                }
                              }
                            },
                            "description": {
                              "type": "string"
                            }
                          },
                          "required": [
                            "width",
                            "height",
                            "cells"
                          ]
                        },
                        "sceneDescription": {
                          "type": "string"
                        },
                        "creaturePositions": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "name",
                        "creatures",
                        "currentTurn",
                        "round",
                        "isActive",
                        "history",
                        "mode"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data"
                  ]
                }
              }
            }
          },
          "404": {
            "description": "Battle not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "enum": [
                        false
                      ]
                    },
                    "error": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "success",
                    "error"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/battles/{id}/creatures/{creatureId}": {
      "put": {
        "tags": [
          "battle",
          "mcp"
        ],
        "summary": "Update creature",
        "description": "Update properties of a creature in battle",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "example": "battle-123"
            },
            "required": true,
            "name": "id",
            "in": "path"
          },
          {
            "schema": {
              "type": "string",
              "example": "creature-456"
            },
            "required": true,
            "name": "creatureId",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "hp": {
                    "type": "integer"
                  },
                  "maxHp": {
                    "type": "integer",
                    "exclusiveMinimum": 0
                  },
                  "ac": {
                    "type": "integer",
                    "minimum": 0
                  },
                  "initiative": {
                    "type": "integer"
                  },
                  "stats": {
                    "type": "object",
                    "properties": {
                      "str": {
                        "type": "integer",
                        "minimum": 1,
                        "maximum": 30
                      },
                      "dex": {
                        "type": "integer",
                        "minimum": 1,
                        "maximum": 30
                      },
                      "con": {
                        "type": "integer",
                        "minimum": 1,
                        "maximum": 30
                      },
                      "int": {
                        "type": "integer",
                        "minimum": 1,
                        "maximum": 30
                      },
                      "wis": {
                        "type": "integer",
                        "minimum": 1,
                        "maximum": 30
                      },
                      "cha": {
                        "type": "integer",
                        "minimum": 1,
                        "maximum": 30
                      }
                    },
                    "required": [
                      "str",
                      "dex",
                      "con",
                      "int",
                      "wis",
                      "cha"
                    ]
                  },
                  "statusEffects": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string"
                        },
                        "description": {
                          "type": "string"
                        },
                        "duration": {
                          "type": "number"
                        },
                        "concentration": {
                          "type": "boolean"
                        }
                      },
                      "required": [
                        "name"
                      ]
                    }
                  },
                  "position": {
                    "type": "object",
                    "properties": {
                      "x": {
                        "type": "integer",
                        "minimum": 0,
                        "example": 5
                      },
                      "y": {
                        "type": "integer",
                        "minimum": 0,
                        "example": 3
                      }
                    },
                    "required": [
                      "x",
                      "y"
                    ]
                  },
                  "size": {
                    "type": "string",
                    "enum": [
                      "Tiny",
                      "Small",
                      "Medium",
                      "Large",
                      "Huge",
                      "Gargantuan"
                    ]
                  },
                  "isPlayer": {
                    "type": "boolean"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Creature updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "enum": [
                        true
                      ]
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        },
                        "creatures": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "name": {
                                "type": "string"
                              },
                              "hp": {
                                "type": "integer"
                              },
                              "maxHp": {
                                "type": "integer",
                                "exclusiveMinimum": 0
                              },
                              "ac": {
                                "type": "integer",
                                "minimum": 0
                              },
                              "initiative": {
                                "type": "integer"
                              },
                              "stats": {
                                "type": "object",
                                "properties": {
                                  "str": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "dex": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "con": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "int": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "wis": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "cha": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  }
                                },
                                "required": [
                                  "str",
                                  "dex",
                                  "con",
                                  "int",
                                  "wis",
                                  "cha"
                                ]
                              },
                              "statusEffects": {
                                "type": "array",
                                "items": {
                                  "type": "object",
                                  "properties": {
                                    "name": {
                                      "type": "string"
                                    },
                                    "description": {
                                      "type": "string"
                                    },
                                    "duration": {
                                      "type": "number"
                                    },
                                    "concentration": {
                                      "type": "boolean"
                                    }
                                  },
                                  "required": [
                                    "name"
                                  ]
                                }
                              },
                              "position": {
                                "type": "object",
                                "properties": {
                                  "x": {
                                    "type": "integer",
                                    "minimum": 0,
                                    "example": 5
                                  },
                                  "y": {
                                    "type": "integer",
                                    "minimum": 0,
                                    "example": 3
                                  }
                                },
                                "required": [
                                  "x",
                                  "y"
                                ]
                              },
                              "size": {
                                "type": "string",
                                "enum": [
                                  "Tiny",
                                  "Small",
                                  "Medium",
                                  "Large",
                                  "Huge",
                                  "Gargantuan"
                                ]
                              },
                              "isPlayer": {
                                "type": "boolean"
                              }
                            },
                            "required": [
                              "id",
                              "name",
                              "hp",
                              "maxHp",
                              "ac",
                              "initiative",
                              "stats",
                              "statusEffects",
                              "size",
                              "isPlayer"
                            ]
                          }
                        },
                        "currentTurn": {
                          "type": "integer",
                          "minimum": 0
                        },
                        "round": {
                          "type": "integer",
                          "minimum": 0
                        },
                        "isActive": {
                          "type": "boolean"
                        },
                        "history": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "timestamp": {
                                "type": "number"
                              },
                              "type": {
                                "type": "string"
                              },
                              "data": {},
                              "previousState": {}
                            },
                            "required": [
                              "id",
                              "timestamp",
                              "type"
                            ]
                          }
                        },
                        "mode": {
                          "type": "string",
                          "enum": [
                            "TheatreOfMind",
                            "GridBased"
                          ]
                        },
                        "map": {
                          "type": "object",
                          "properties": {
                            "width": {
                              "type": "integer",
                              "exclusiveMinimum": 0
                            },
                            "height": {
                              "type": "integer",
                              "exclusiveMinimum": 0
                            },
                            "cells": {
                              "type": "array",
                              "items": {
                                "type": "array",
                                "items": {
                                  "type": "object",
                                  "properties": {
                                    "x": {
                                      "type": "integer",
                                      "minimum": 0
                                    },
                                    "y": {
                                      "type": "integer",
                                      "minimum": 0
                                    },
                                    "terrain": {
                                      "type": "string",
                                      "enum": [
                                        "Empty",
                                        "Wall",
                                        "DifficultTerrain",
                                        "Water",
                                        "Pit",
                                        "Door",
                                        "Window",
                                        "Cover",
                                        "HeavyCover",
                                        "Stairs",
                                        "Hazard"
                                      ]
                                    },
                                    "doorOpen": {
                                      "type": "boolean"
                                    },
                                    "elevation": {
                                      "type": "number"
                                    },
                                    "hazardDamage": {
                                      "type": "number"
                                    }
                                  },
                                  "required": [
                                    "x",
                                    "y",
                                    "terrain"
                                  ]
                                }
                              }
                            },
                            "description": {
                              "type": "string"
                            }
                          },
                          "required": [
                            "width",
                            "height",
                            "cells"
                          ]
                        },
                        "sceneDescription": {
                          "type": "string"
                        },
                        "creaturePositions": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "name",
                        "creatures",
                        "currentTurn",
                        "round",
                        "isActive",
                        "history",
                        "mode"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data"
                  ]
                }
              }
            }
          },
          "404": {
            "description": "Battle or creature not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "enum": [
                        false
                      ]
                    },
                    "error": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "success",
                    "error"
                  ]
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "battle",
          "mcp"
        ],
        "summary": "Remove creature from battle",
        "description": "Remove a creature from an existing battle",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "example": "battle-123"
            },
            "required": true,
            "name": "id",
            "in": "path"
          },
          {
            "schema": {
              "type": "string",
              "example": "creature-456"
            },
            "required": true,
            "name": "creatureId",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Creature removed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "enum": [
                        true
                      ]
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        },
                        "creatures": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "name": {
                                "type": "string"
                              },
                              "hp": {
                                "type": "integer"
                              },
                              "maxHp": {
                                "type": "integer",
                                "exclusiveMinimum": 0
                              },
                              "ac": {
                                "type": "integer",
                                "minimum": 0
                              },
                              "initiative": {
                                "type": "integer"
                              },
                              "stats": {
                                "type": "object",
                                "properties": {
                                  "str": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "dex": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "con": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "int": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "wis": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "cha": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  }
                                },
                                "required": [
                                  "str",
                                  "dex",
                                  "con",
                                  "int",
                                  "wis",
                                  "cha"
                                ]
                              },
                              "statusEffects": {
                                "type": "array",
                                "items": {
                                  "type": "object",
                                  "properties": {
                                    "name": {
                                      "type": "string"
                                    },
                                    "description": {
                                      "type": "string"
                                    },
                                    "duration": {
                                      "type": "number"
                                    },
                                    "concentration": {
                                      "type": "boolean"
                                    }
                                  },
                                  "required": [
                                    "name"
                                  ]
                                }
                              },
                              "position": {
                                "type": "object",
                                "properties": {
                                  "x": {
                                    "type": "integer",
                                    "minimum": 0,
                                    "example": 5
                                  },
                                  "y": {
                                    "type": "integer",
                                    "minimum": 0,
                                    "example": 3
                                  }
                                },
                                "required": [
                                  "x",
                                  "y"
                                ]
                              },
                              "size": {
                                "type": "string",
                                "enum": [
                                  "Tiny",
                                  "Small",
                                  "Medium",
                                  "Large",
                                  "Huge",
                                  "Gargantuan"
                                ]
                              },
                              "isPlayer": {
                                "type": "boolean"
                              }
                            },
                            "required": [
                              "id",
                              "name",
                              "hp",
                              "maxHp",
                              "ac",
                              "initiative",
                              "stats",
                              "statusEffects",
                              "size",
                              "isPlayer"
                            ]
                          }
                        },
                        "currentTurn": {
                          "type": "integer",
                          "minimum": 0
                        },
                        "round": {
                          "type": "integer",
                          "minimum": 0
                        },
                        "isActive": {
                          "type": "boolean"
                        },
                        "history": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "timestamp": {
                                "type": "number"
                              },
                              "type": {
                                "type": "string"
                              },
                              "data": {},
                              "previousState": {}
                            },
                            "required": [
                              "id",
                              "timestamp",
                              "type"
                            ]
                          }
                        },
                        "mode": {
                          "type": "string",
                          "enum": [
                            "TheatreOfMind",
                            "GridBased"
                          ]
                        },
                        "map": {
                          "type": "object",
                          "properties": {
                            "width": {
                              "type": "integer",
                              "exclusiveMinimum": 0
                            },
                            "height": {
                              "type": "integer",
                              "exclusiveMinimum": 0
                            },
                            "cells": {
                              "type": "array",
                              "items": {
                                "type": "array",
                                "items": {
                                  "type": "object",
                                  "properties": {
                                    "x": {
                                      "type": "integer",
                                      "minimum": 0
                                    },
                                    "y": {
                                      "type": "integer",
                                      "minimum": 0
                                    },
                                    "terrain": {
                                      "type": "string",
                                      "enum": [
                                        "Empty",
                                        "Wall",
                                        "DifficultTerrain",
                                        "Water",
                                        "Pit",
                                        "Door",
                                        "Window",
                                        "Cover",
                                        "HeavyCover",
                                        "Stairs",
                                        "Hazard"
                                      ]
                                    },
                                    "doorOpen": {
                                      "type": "boolean"
                                    },
                                    "elevation": {
                                      "type": "number"
                                    },
                                    "hazardDamage": {
                                      "type": "number"
                                    }
                                  },
                                  "required": [
                                    "x",
                                    "y",
                                    "terrain"
                                  ]
                                }
                              }
                            },
                            "description": {
                              "type": "string"
                            }
                          },
                          "required": [
                            "width",
                            "height",
                            "cells"
                          ]
                        },
                        "sceneDescription": {
                          "type": "string"
                        },
                        "creaturePositions": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "name",
                        "creatures",
                        "currentTurn",
                        "round",
                        "isActive",
                        "history",
                        "mode"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data"
                  ]
                }
              }
            }
          },
          "404": {
            "description": "Battle or creature not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "enum": [
                        false
                      ]
                    },
                    "error": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "success",
                    "error"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/battles/{id}/creatures/{creatureId}/move": {
      "post": {
        "tags": [
          "battle",
          "mcp"
        ],
        "summary": "Move creature",
        "description": "Move a creature to a new position on the battle map",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "example": "battle-123"
            },
            "required": true,
            "name": "id",
            "in": "path"
          },
          {
            "schema": {
              "type": "string",
              "example": "creature-456"
            },
            "required": true,
            "name": "creatureId",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "position": {
                    "type": "object",
                    "properties": {
                      "x": {
                        "type": "integer",
                        "minimum": 0,
                        "example": 5
                      },
                      "y": {
                        "type": "integer",
                        "minimum": 0,
                        "example": 3
                      }
                    },
                    "required": [
                      "x",
                      "y"
                    ]
                  }
                },
                "required": [
                  "position"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Creature moved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "enum": [
                        true
                      ]
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        },
                        "creatures": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "name": {
                                "type": "string"
                              },
                              "hp": {
                                "type": "integer"
                              },
                              "maxHp": {
                                "type": "integer",
                                "exclusiveMinimum": 0
                              },
                              "ac": {
                                "type": "integer",
                                "minimum": 0
                              },
                              "initiative": {
                                "type": "integer"
                              },
                              "stats": {
                                "type": "object",
                                "properties": {
                                  "str": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "dex": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "con": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "int": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "wis": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "cha": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  }
                                },
                                "required": [
                                  "str",
                                  "dex",
                                  "con",
                                  "int",
                                  "wis",
                                  "cha"
                                ]
                              },
                              "statusEffects": {
                                "type": "array",
                                "items": {
                                  "type": "object",
                                  "properties": {
                                    "name": {
                                      "type": "string"
                                    },
                                    "description": {
                                      "type": "string"
                                    },
                                    "duration": {
                                      "type": "number"
                                    },
                                    "concentration": {
                                      "type": "boolean"
                                    }
                                  },
                                  "required": [
                                    "name"
                                  ]
                                }
                              },
                              "position": {
                                "type": "object",
                                "properties": {
                                  "x": {
                                    "type": "integer",
                                    "minimum": 0,
                                    "example": 5
                                  },
                                  "y": {
                                    "type": "integer",
                                    "minimum": 0,
                                    "example": 3
                                  }
                                },
                                "required": [
                                  "x",
                                  "y"
                                ]
                              },
                              "size": {
                                "type": "string",
                                "enum": [
                                  "Tiny",
                                  "Small",
                                  "Medium",
                                  "Large",
                                  "Huge",
                                  "Gargantuan"
                                ]
                              },
                              "isPlayer": {
                                "type": "boolean"
                              }
                            },
                            "required": [
                              "id",
                              "name",
                              "hp",
                              "maxHp",
                              "ac",
                              "initiative",
                              "stats",
                              "statusEffects",
                              "size",
                              "isPlayer"
                            ]
                          }
                        },
                        "currentTurn": {
                          "type": "integer",
                          "minimum": 0
                        },
                        "round": {
                          "type": "integer",
                          "minimum": 0
                        },
                        "isActive": {
                          "type": "boolean"
                        },
                        "history": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "timestamp": {
                                "type": "number"
                              },
                              "type": {
                                "type": "string"
                              },
                              "data": {},
                              "previousState": {}
                            },
                            "required": [
                              "id",
                              "timestamp",
                              "type"
                            ]
                          }
                        },
                        "mode": {
                          "type": "string",
                          "enum": [
                            "TheatreOfMind",
                            "GridBased"
                          ]
                        },
                        "map": {
                          "type": "object",
                          "properties": {
                            "width": {
                              "type": "integer",
                              "exclusiveMinimum": 0
                            },
                            "height": {
                              "type": "integer",
                              "exclusiveMinimum": 0
                            },
                            "cells": {
                              "type": "array",
                              "items": {
                                "type": "array",
                                "items": {
                                  "type": "object",
                                  "properties": {
                                    "x": {
                                      "type": "integer",
                                      "minimum": 0
                                    },
                                    "y": {
                                      "type": "integer",
                                      "minimum": 0
                                    },
                                    "terrain": {
                                      "type": "string",
                                      "enum": [
                                        "Empty",
                                        "Wall",
                                        "DifficultTerrain",
                                        "Water",
                                        "Pit",
                                        "Door",
                                        "Window",
                                        "Cover",
                                        "HeavyCover",
                                        "Stairs",
                                        "Hazard"
                                      ]
                                    },
                                    "doorOpen": {
                                      "type": "boolean"
                                    },
                                    "elevation": {
                                      "type": "number"
                                    },
                                    "hazardDamage": {
                                      "type": "number"
                                    }
                                  },
                                  "required": [
                                    "x",
                                    "y",
                                    "terrain"
                                  ]
                                }
                              }
                            },
                            "description": {
                              "type": "string"
                            }
                          },
                          "required": [
                            "width",
                            "height",
                            "cells"
                          ]
                        },
                        "sceneDescription": {
                          "type": "string"
                        },
                        "creaturePositions": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "name",
                        "creatures",
                        "currentTurn",
                        "round",
                        "isActive",
                        "history",
                        "mode"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data"
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Invalid move (e.g., outside map bounds, impossible command)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "enum": [
                        false
                      ]
                    },
                    "error": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "success",
                    "error"
                  ]
                }
              }
            }
          },
          "404": {
            "description": "Battle or creature not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "enum": [
                        false
                      ]
                    },
                    "error": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "success",
                    "error"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/battles/{id}/next-turn": {
      "post": {
        "tags": [
          "battle",
          "mcp"
        ],
        "summary": "Advance to next turn",
        "description": "Move to the next creature's turn in initiative order",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "example": "battle-123"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Advanced to next turn",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "enum": [
                        true
                      ]
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        },
                        "creatures": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "name": {
                                "type": "string"
                              },
                              "hp": {
                                "type": "integer"
                              },
                              "maxHp": {
                                "type": "integer",
                                "exclusiveMinimum": 0
                              },
                              "ac": {
                                "type": "integer",
                                "minimum": 0
                              },
                              "initiative": {
                                "type": "integer"
                              },
                              "stats": {
                                "type": "object",
                                "properties": {
                                  "str": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "dex": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "con": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "int": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "wis": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "cha": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  }
                                },
                                "required": [
                                  "str",
                                  "dex",
                                  "con",
                                  "int",
                                  "wis",
                                  "cha"
                                ]
                              },
                              "statusEffects": {
                                "type": "array",
                                "items": {
                                  "type": "object",
                                  "properties": {
                                    "name": {
                                      "type": "string"
                                    },
                                    "description": {
                                      "type": "string"
                                    },
                                    "duration": {
                                      "type": "number"
                                    },
                                    "concentration": {
                                      "type": "boolean"
                                    }
                                  },
                                  "required": [
                                    "name"
                                  ]
                                }
                              },
                              "position": {
                                "type": "object",
                                "properties": {
                                  "x": {
                                    "type": "integer",
                                    "minimum": 0,
                                    "example": 5
                                  },
                                  "y": {
                                    "type": "integer",
                                    "minimum": 0,
                                    "example": 3
                                  }
                                },
                                "required": [
                                  "x",
                                  "y"
                                ]
                              },
                              "size": {
                                "type": "string",
                                "enum": [
                                  "Tiny",
                                  "Small",
                                  "Medium",
                                  "Large",
                                  "Huge",
                                  "Gargantuan"
                                ]
                              },
                              "isPlayer": {
                                "type": "boolean"
                              }
                            },
                            "required": [
                              "id",
                              "name",
                              "hp",
                              "maxHp",
                              "ac",
                              "initiative",
                              "stats",
                              "statusEffects",
                              "size",
                              "isPlayer"
                            ]
                          }
                        },
                        "currentTurn": {
                          "type": "integer",
                          "minimum": 0
                        },
                        "round": {
                          "type": "integer",
                          "minimum": 0
                        },
                        "isActive": {
                          "type": "boolean"
                        },
                        "history": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "timestamp": {
                                "type": "number"
                              },
                              "type": {
                                "type": "string"
                              },
                              "data": {},
                              "previousState": {}
                            },
                            "required": [
                              "id",
                              "timestamp",
                              "type"
                            ]
                          }
                        },
                        "mode": {
                          "type": "string",
                          "enum": [
                            "TheatreOfMind",
                            "GridBased"
                          ]
                        },
                        "map": {
                          "type": "object",
                          "properties": {
                            "width": {
                              "type": "integer",
                              "exclusiveMinimum": 0
                            },
                            "height": {
                              "type": "integer",
                              "exclusiveMinimum": 0
                            },
                            "cells": {
                              "type": "array",
                              "items": {
                                "type": "array",
                                "items": {
                                  "type": "object",
                                  "properties": {
                                    "x": {
                                      "type": "integer",
                                      "minimum": 0
                                    },
                                    "y": {
                                      "type": "integer",
                                      "minimum": 0
                                    },
                                    "terrain": {
                                      "type": "string",
                                      "enum": [
                                        "Empty",
                                        "Wall",
                                        "DifficultTerrain",
                                        "Water",
                                        "Pit",
                                        "Door",
                                        "Window",
                                        "Cover",
                                        "HeavyCover",
                                        "Stairs",
                                        "Hazard"
                                      ]
                                    },
                                    "doorOpen": {
                                      "type": "boolean"
                                    },
                                    "elevation": {
                                      "type": "number"
                                    },
                                    "hazardDamage": {
                                      "type": "number"
                                    }
                                  },
                                  "required": [
                                    "x",
                                    "y",
                                    "terrain"
                                  ]
                                }
                              }
                            },
                            "description": {
                              "type": "string"
                            }
                          },
                          "required": [
                            "width",
                            "height",
                            "cells"
                          ]
                        },
                        "sceneDescription": {
                          "type": "string"
                        },
                        "creaturePositions": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "name",
                        "creatures",
                        "currentTurn",
                        "round",
                        "isActive",
                        "history",
                        "mode"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data"
                  ]
                }
              }
            }
          },
          "404": {
            "description": "Battle not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "enum": [
                        false
                      ]
                    },
                    "error": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "success",
                    "error"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/battles/{id}/start": {
      "post": {
        "tags": [
          "battle",
          "mcp"
        ],
        "summary": "Start battle",
        "description": "Start the battle and begin tracking initiative",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "example": "battle-123"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Battle started",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "enum": [
                        true
                      ]
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        },
                        "creatures": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "name": {
                                "type": "string"
                              },
                              "hp": {
                                "type": "integer"
                              },
                              "maxHp": {
                                "type": "integer",
                                "exclusiveMinimum": 0
                              },
                              "ac": {
                                "type": "integer",
                                "minimum": 0
                              },
                              "initiative": {
                                "type": "integer"
                              },
                              "stats": {
                                "type": "object",
                                "properties": {
                                  "str": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "dex": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "con": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "int": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "wis": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "cha": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  }
                                },
                                "required": [
                                  "str",
                                  "dex",
                                  "con",
                                  "int",
                                  "wis",
                                  "cha"
                                ]
                              },
                              "statusEffects": {
                                "type": "array",
                                "items": {
                                  "type": "object",
                                  "properties": {
                                    "name": {
                                      "type": "string"
                                    },
                                    "description": {
                                      "type": "string"
                                    },
                                    "duration": {
                                      "type": "number"
                                    },
                                    "concentration": {
                                      "type": "boolean"
                                    }
                                  },
                                  "required": [
                                    "name"
                                  ]
                                }
                              },
                              "position": {
                                "type": "object",
                                "properties": {
                                  "x": {
                                    "type": "integer",
                                    "minimum": 0,
                                    "example": 5
                                  },
                                  "y": {
                                    "type": "integer",
                                    "minimum": 0,
                                    "example": 3
                                  }
                                },
                                "required": [
                                  "x",
                                  "y"
                                ]
                              },
                              "size": {
                                "type": "string",
                                "enum": [
                                  "Tiny",
                                  "Small",
                                  "Medium",
                                  "Large",
                                  "Huge",
                                  "Gargantuan"
                                ]
                              },
                              "isPlayer": {
                                "type": "boolean"
                              }
                            },
                            "required": [
                              "id",
                              "name",
                              "hp",
                              "maxHp",
                              "ac",
                              "initiative",
                              "stats",
                              "statusEffects",
                              "size",
                              "isPlayer"
                            ]
                          }
                        },
                        "currentTurn": {
                          "type": "integer",
                          "minimum": 0
                        },
                        "round": {
                          "type": "integer",
                          "minimum": 0
                        },
                        "isActive": {
                          "type": "boolean"
                        },
                        "history": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "timestamp": {
                                "type": "number"
                              },
                              "type": {
                                "type": "string"
                              },
                              "data": {},
                              "previousState": {}
                            },
                            "required": [
                              "id",
                              "timestamp",
                              "type"
                            ]
                          }
                        },
                        "mode": {
                          "type": "string",
                          "enum": [
                            "TheatreOfMind",
                            "GridBased"
                          ]
                        },
                        "map": {
                          "type": "object",
                          "properties": {
                            "width": {
                              "type": "integer",
                              "exclusiveMinimum": 0
                            },
                            "height": {
                              "type": "integer",
                              "exclusiveMinimum": 0
                            },
                            "cells": {
                              "type": "array",
                              "items": {
                                "type": "array",
                                "items": {
                                  "type": "object",
                                  "properties": {
                                    "x": {
                                      "type": "integer",
                                      "minimum": 0
                                    },
                                    "y": {
                                      "type": "integer",
                                      "minimum": 0
                                    },
                                    "terrain": {
                                      "type": "string",
                                      "enum": [
                                        "Empty",
                                        "Wall",
                                        "DifficultTerrain",
                                        "Water",
                                        "Pit",
                                        "Door",
                                        "Window",
                                        "Cover",
                                        "HeavyCover",
                                        "Stairs",
                                        "Hazard"
                                      ]
                                    },
                                    "doorOpen": {
                                      "type": "boolean"
                                    },
                                    "elevation": {
                                      "type": "number"
                                    },
                                    "hazardDamage": {
                                      "type": "number"
                                    }
                                  },
                                  "required": [
                                    "x",
                                    "y",
                                    "terrain"
                                  ]
                                }
                              }
                            },
                            "description": {
                              "type": "string"
                            }
                          },
                          "required": [
                            "width",
                            "height",
                            "cells"
                          ]
                        },
                        "sceneDescription": {
                          "type": "string"
                        },
                        "creaturePositions": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "name",
                        "creatures",
                        "currentTurn",
                        "round",
                        "isActive",
                        "history",
                        "mode"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data"
                  ]
                }
              }
            }
          },
          "404": {
            "description": "Battle not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "enum": [
                        false
                      ]
                    },
                    "error": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "success",
                    "error"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/battles/{id}/undo": {
      "post": {
        "tags": [
          "battle",
          "mcp"
        ],
        "summary": "Undo last action",
        "description": "Undo the last action performed in the battle",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "example": "battle-123"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Action undone successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "enum": [
                        true
                      ]
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        },
                        "creatures": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "name": {
                                "type": "string"
                              },
                              "hp": {
                                "type": "integer"
                              },
                              "maxHp": {
                                "type": "integer",
                                "exclusiveMinimum": 0
                              },
                              "ac": {
                                "type": "integer",
                                "minimum": 0
                              },
                              "initiative": {
                                "type": "integer"
                              },
                              "stats": {
                                "type": "object",
                                "properties": {
                                  "str": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "dex": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "con": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "int": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "wis": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "cha": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  }
                                },
                                "required": [
                                  "str",
                                  "dex",
                                  "con",
                                  "int",
                                  "wis",
                                  "cha"
                                ]
                              },
                              "statusEffects": {
                                "type": "array",
                                "items": {
                                  "type": "object",
                                  "properties": {
                                    "name": {
                                      "type": "string"
                                    },
                                    "description": {
                                      "type": "string"
                                    },
                                    "duration": {
                                      "type": "number"
                                    },
                                    "concentration": {
                                      "type": "boolean"
                                    }
                                  },
                                  "required": [
                                    "name"
                                  ]
                                }
                              },
                              "position": {
                                "type": "object",
                                "properties": {
                                  "x": {
                                    "type": "integer",
                                    "minimum": 0,
                                    "example": 5
                                  },
                                  "y": {
                                    "type": "integer",
                                    "minimum": 0,
                                    "example": 3
                                  }
                                },
                                "required": [
                                  "x",
                                  "y"
                                ]
                              },
                              "size": {
                                "type": "string",
                                "enum": [
                                  "Tiny",
                                  "Small",
                                  "Medium",
                                  "Large",
                                  "Huge",
                                  "Gargantuan"
                                ]
                              },
                              "isPlayer": {
                                "type": "boolean"
                              }
                            },
                            "required": [
                              "id",
                              "name",
                              "hp",
                              "maxHp",
                              "ac",
                              "initiative",
                              "stats",
                              "statusEffects",
                              "size",
                              "isPlayer"
                            ]
                          }
                        },
                        "currentTurn": {
                          "type": "integer",
                          "minimum": 0
                        },
                        "round": {
                          "type": "integer",
                          "minimum": 0
                        },
                        "isActive": {
                          "type": "boolean"
                        },
                        "history": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "timestamp": {
                                "type": "number"
                              },
                              "type": {
                                "type": "string"
                              },
                              "data": {},
                              "previousState": {}
                            },
                            "required": [
                              "id",
                              "timestamp",
                              "type"
                            ]
                          }
                        },
                        "mode": {
                          "type": "string",
                          "enum": [
                            "TheatreOfMind",
                            "GridBased"
                          ]
                        },
                        "map": {
                          "type": "object",
                          "properties": {
                            "width": {
                              "type": "integer",
                              "exclusiveMinimum": 0
                            },
                            "height": {
                              "type": "integer",
                              "exclusiveMinimum": 0
                            },
                            "cells": {
                              "type": "array",
                              "items": {
                                "type": "array",
                                "items": {
                                  "type": "object",
                                  "properties": {
                                    "x": {
                                      "type": "integer",
                                      "minimum": 0
                                    },
                                    "y": {
                                      "type": "integer",
                                      "minimum": 0
                                    },
                                    "terrain": {
                                      "type": "string",
                                      "enum": [
                                        "Empty",
                                        "Wall",
                                        "DifficultTerrain",
                                        "Water",
                                        "Pit",
                                        "Door",
                                        "Window",
                                        "Cover",
                                        "HeavyCover",
                                        "Stairs",
                                        "Hazard"
                                      ]
                                    },
                                    "doorOpen": {
                                      "type": "boolean"
                                    },
                                    "elevation": {
                                      "type": "number"
                                    },
                                    "hazardDamage": {
                                      "type": "number"
                                    }
                                  },
                                  "required": [
                                    "x",
                                    "y",
                                    "terrain"
                                  ]
                                }
                              }
                            },
                            "description": {
                              "type": "string"
                            }
                          },
                          "required": [
                            "width",
                            "height",
                            "cells"
                          ]
                        },
                        "sceneDescription": {
                          "type": "string"
                        },
                        "creaturePositions": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "name",
                        "creatures",
                        "currentTurn",
                        "round",
                        "isActive",
                        "history",
                        "mode"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data"
                  ]
                }
              }
            }
          },
          "404": {
            "description": "Battle not found or no actions to undo",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "enum": [
                        false
                      ]
                    },
                    "error": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "success",
                    "error"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/battles/{id}/map/terrain": {
      "post": {
        "tags": [
          "battle",
          "mcp"
        ],
        "summary": "Set terrain",
        "description": "Set terrain type for one or more map cells",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "example": "battle-123"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "positions": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "x": {
                          "type": "integer",
                          "minimum": 0,
                          "example": 5
                        },
                        "y": {
                          "type": "integer",
                          "minimum": 0,
                          "example": 3
                        }
                      },
                      "required": [
                        "x",
                        "y"
                      ]
                    },
                    "minItems": 1
                  },
                  "terrain": {
                    "type": "string",
                    "enum": [
                      "Empty",
                      "Wall",
                      "DifficultTerrain",
                      "Water",
                      "Pit",
                      "Door",
                      "Window",
                      "Cover",
                      "HeavyCover",
                      "Stairs",
                      "Hazard"
                    ]
                  },
                  "doorOpen": {
                    "type": "boolean"
                  },
                  "elevation": {
                    "type": "number"
                  },
                  "hazardDamage": {
                    "type": "number"
                  }
                },
                "required": [
                  "positions",
                  "terrain"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Terrain updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "enum": [
                        true
                      ]
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        },
                        "creatures": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "name": {
                                "type": "string"
                              },
                              "hp": {
                                "type": "integer"
                              },
                              "maxHp": {
                                "type": "integer",
                                "exclusiveMinimum": 0
                              },
                              "ac": {
                                "type": "integer",
                                "minimum": 0
                              },
                              "initiative": {
                                "type": "integer"
                              },
                              "stats": {
                                "type": "object",
                                "properties": {
                                  "str": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "dex": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "con": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "int": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "wis": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "cha": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  }
                                },
                                "required": [
                                  "str",
                                  "dex",
                                  "con",
                                  "int",
                                  "wis",
                                  "cha"
                                ]
                              },
                              "statusEffects": {
                                "type": "array",
                                "items": {
                                  "type": "object",
                                  "properties": {
                                    "name": {
                                      "type": "string"
                                    },
                                    "description": {
                                      "type": "string"
                                    },
                                    "duration": {
                                      "type": "number"
                                    },
                                    "concentration": {
                                      "type": "boolean"
                                    }
                                  },
                                  "required": [
                                    "name"
                                  ]
                                }
                              },
                              "position": {
                                "type": "object",
                                "properties": {
                                  "x": {
                                    "type": "integer",
                                    "minimum": 0,
                                    "example": 5
                                  },
                                  "y": {
                                    "type": "integer",
                                    "minimum": 0,
                                    "example": 3
                                  }
                                },
                                "required": [
                                  "x",
                                  "y"
                                ]
                              },
                              "size": {
                                "type": "string",
                                "enum": [
                                  "Tiny",
                                  "Small",
                                  "Medium",
                                  "Large",
                                  "Huge",
                                  "Gargantuan"
                                ]
                              },
                              "isPlayer": {
                                "type": "boolean"
                              }
                            },
                            "required": [
                              "id",
                              "name",
                              "hp",
                              "maxHp",
                              "ac",
                              "initiative",
                              "stats",
                              "statusEffects",
                              "size",
                              "isPlayer"
                            ]
                          }
                        },
                        "currentTurn": {
                          "type": "integer",
                          "minimum": 0
                        },
                        "round": {
                          "type": "integer",
                          "minimum": 0
                        },
                        "isActive": {
                          "type": "boolean"
                        },
                        "history": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "timestamp": {
                                "type": "number"
                              },
                              "type": {
                                "type": "string"
                              },
                              "data": {},
                              "previousState": {}
                            },
                            "required": [
                              "id",
                              "timestamp",
                              "type"
                            ]
                          }
                        },
                        "mode": {
                          "type": "string",
                          "enum": [
                            "TheatreOfMind",
                            "GridBased"
                          ]
                        },
                        "map": {
                          "type": "object",
                          "properties": {
                            "width": {
                              "type": "integer",
                              "exclusiveMinimum": 0
                            },
                            "height": {
                              "type": "integer",
                              "exclusiveMinimum": 0
                            },
                            "cells": {
                              "type": "array",
                              "items": {
                                "type": "array",
                                "items": {
                                  "type": "object",
                                  "properties": {
                                    "x": {
                                      "type": "integer",
                                      "minimum": 0
                                    },
                                    "y": {
                                      "type": "integer",
                                      "minimum": 0
                                    },
                                    "terrain": {
                                      "type": "string",
                                      "enum": [
                                        "Empty",
                                        "Wall",
                                        "DifficultTerrain",
                                        "Water",
                                        "Pit",
                                        "Door",
                                        "Window",
                                        "Cover",
                                        "HeavyCover",
                                        "Stairs",
                                        "Hazard"
                                      ]
                                    },
                                    "doorOpen": {
                                      "type": "boolean"
                                    },
                                    "elevation": {
                                      "type": "number"
                                    },
                                    "hazardDamage": {
                                      "type": "number"
                                    }
                                  },
                                  "required": [
                                    "x",
                                    "y",
                                    "terrain"
                                  ]
                                }
                              }
                            },
                            "description": {
                              "type": "string"
                            }
                          },
                          "required": [
                            "width",
                            "height",
                            "cells"
                          ]
                        },
                        "sceneDescription": {
                          "type": "string"
                        },
                        "creaturePositions": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "name",
                        "creatures",
                        "currentTurn",
                        "round",
                        "isActive",
                        "history",
                        "mode"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data"
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Invalid request (e.g., not a grid-based battle)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "enum": [
                        false
                      ]
                    },
                    "error": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "success",
                    "error"
                  ]
                }
              }
            }
          },
          "404": {
            "description": "Battle not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "enum": [
                        false
                      ]
                    },
                    "error": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "success",
                    "error"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/battles/{id}/map/doors/toggle": {
      "post": {
        "tags": [
          "battle",
          "mcp"
        ],
        "summary": "Toggle door",
        "description": "Open or close a door on the battle map",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "example": "battle-123"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "position": {
                    "type": "object",
                    "properties": {
                      "x": {
                        "type": "integer",
                        "minimum": 0,
                        "example": 5
                      },
                      "y": {
                        "type": "integer",
                        "minimum": 0,
                        "example": 3
                      }
                    },
                    "required": [
                      "x",
                      "y"
                    ]
                  }
                },
                "required": [
                  "position"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Door toggled successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "enum": [
                        true
                      ]
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        },
                        "creatures": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "name": {
                                "type": "string"
                              },
                              "hp": {
                                "type": "integer"
                              },
                              "maxHp": {
                                "type": "integer",
                                "exclusiveMinimum": 0
                              },
                              "ac": {
                                "type": "integer",
                                "minimum": 0
                              },
                              "initiative": {
                                "type": "integer"
                              },
                              "stats": {
                                "type": "object",
                                "properties": {
                                  "str": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "dex": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "con": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "int": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "wis": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "cha": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  }
                                },
                                "required": [
                                  "str",
                                  "dex",
                                  "con",
                                  "int",
                                  "wis",
                                  "cha"
                                ]
                              },
                              "statusEffects": {
                                "type": "array",
                                "items": {
                                  "type": "object",
                                  "properties": {
                                    "name": {
                                      "type": "string"
                                    },
                                    "description": {
                                      "type": "string"
                                    },
                                    "duration": {
                                      "type": "number"
                                    },
                                    "concentration": {
                                      "type": "boolean"
                                    }
                                  },
                                  "required": [
                                    "name"
                                  ]
                                }
                              },
                              "position": {
                                "type": "object",
                                "properties": {
                                  "x": {
                                    "type": "integer",
                                    "minimum": 0,
                                    "example": 5
                                  },
                                  "y": {
                                    "type": "integer",
                                    "minimum": 0,
                                    "example": 3
                                  }
                                },
                                "required": [
                                  "x",
                                  "y"
                                ]
                              },
                              "size": {
                                "type": "string",
                                "enum": [
                                  "Tiny",
                                  "Small",
                                  "Medium",
                                  "Large",
                                  "Huge",
                                  "Gargantuan"
                                ]
                              },
                              "isPlayer": {
                                "type": "boolean"
                              }
                            },
                            "required": [
                              "id",
                              "name",
                              "hp",
                              "maxHp",
                              "ac",
                              "initiative",
                              "stats",
                              "statusEffects",
                              "size",
                              "isPlayer"
                            ]
                          }
                        },
                        "currentTurn": {
                          "type": "integer",
                          "minimum": 0
                        },
                        "round": {
                          "type": "integer",
                          "minimum": 0
                        },
                        "isActive": {
                          "type": "boolean"
                        },
                        "history": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "timestamp": {
                                "type": "number"
                              },
                              "type": {
                                "type": "string"
                              },
                              "data": {},
                              "previousState": {}
                            },
                            "required": [
                              "id",
                              "timestamp",
                              "type"
                            ]
                          }
                        },
                        "mode": {
                          "type": "string",
                          "enum": [
                            "TheatreOfMind",
                            "GridBased"
                          ]
                        },
                        "map": {
                          "type": "object",
                          "properties": {
                            "width": {
                              "type": "integer",
                              "exclusiveMinimum": 0
                            },
                            "height": {
                              "type": "integer",
                              "exclusiveMinimum": 0
                            },
                            "cells": {
                              "type": "array",
                              "items": {
                                "type": "array",
                                "items": {
                                  "type": "object",
                                  "properties": {
                                    "x": {
                                      "type": "integer",
                                      "minimum": 0
                                    },
                                    "y": {
                                      "type": "integer",
                                      "minimum": 0
                                    },
                                    "terrain": {
                                      "type": "string",
                                      "enum": [
                                        "Empty",
                                        "Wall",
                                        "DifficultTerrain",
                                        "Water",
                                        "Pit",
                                        "Door",
                                        "Window",
                                        "Cover",
                                        "HeavyCover",
                                        "Stairs",
                                        "Hazard"
                                      ]
                                    },
                                    "doorOpen": {
                                      "type": "boolean"
                                    },
                                    "elevation": {
                                      "type": "number"
                                    },
                                    "hazardDamage": {
                                      "type": "number"
                                    }
                                  },
                                  "required": [
                                    "x",
                                    "y",
                                    "terrain"
                                  ]
                                }
                              }
                            },
                            "description": {
                              "type": "string"
                            }
                          },
                          "required": [
                            "width",
                            "height",
                            "cells"
                          ]
                        },
                        "sceneDescription": {
                          "type": "string"
                        },
                        "creaturePositions": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "name",
                        "creatures",
                        "currentTurn",
                        "round",
                        "isActive",
                        "history",
                        "mode"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data"
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Invalid request (e.g., position doesn't have a door)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "enum": [
                        false
                      ]
                    },
                    "error": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "success",
                    "error"
                  ]
                }
              }
            }
          },
          "404": {
            "description": "Battle not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "enum": [
                        false
                      ]
                    },
                    "error": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "success",
                    "error"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/battles/{id}/description": {
      "put": {
        "tags": [
          "battle",
          "mcp"
        ],
        "summary": "Update scene description",
        "description": "Update the narrative description of the battle scene (for Theatre of Mind)",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "example": "battle-123"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "description": {
                    "type": "string"
                  }
                },
                "required": [
                  "description"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Scene description updated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "enum": [
                        true
                      ]
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        },
                        "creatures": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "name": {
                                "type": "string"
                              },
                              "hp": {
                                "type": "integer"
                              },
                              "maxHp": {
                                "type": "integer",
                                "exclusiveMinimum": 0
                              },
                              "ac": {
                                "type": "integer",
                                "minimum": 0
                              },
                              "initiative": {
                                "type": "integer"
                              },
                              "stats": {
                                "type": "object",
                                "properties": {
                                  "str": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "dex": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "con": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "int": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "wis": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "cha": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  }
                                },
                                "required": [
                                  "str",
                                  "dex",
                                  "con",
                                  "int",
                                  "wis",
                                  "cha"
                                ]
                              },
                              "statusEffects": {
                                "type": "array",
                                "items": {
                                  "type": "object",
                                  "properties": {
                                    "name": {
                                      "type": "string"
                                    },
                                    "description": {
                                      "type": "string"
                                    },
                                    "duration": {
                                      "type": "number"
                                    },
                                    "concentration": {
                                      "type": "boolean"
                                    }
                                  },
                                  "required": [
                                    "name"
                                  ]
                                }
                              },
                              "position": {
                                "type": "object",
                                "properties": {
                                  "x": {
                                    "type": "integer",
                                    "minimum": 0,
                                    "example": 5
                                  },
                                  "y": {
                                    "type": "integer",
                                    "minimum": 0,
                                    "example": 3
                                  }
                                },
                                "required": [
                                  "x",
                                  "y"
                                ]
                              },
                              "size": {
                                "type": "string",
                                "enum": [
                                  "Tiny",
                                  "Small",
                                  "Medium",
                                  "Large",
                                  "Huge",
                                  "Gargantuan"
                                ]
                              },
                              "isPlayer": {
                                "type": "boolean"
                              }
                            },
                            "required": [
                              "id",
                              "name",
                              "hp",
                              "maxHp",
                              "ac",
                              "initiative",
                              "stats",
                              "statusEffects",
                              "size",
                              "isPlayer"
                            ]
                          }
                        },
                        "currentTurn": {
                          "type": "integer",
                          "minimum": 0
                        },
                        "round": {
                          "type": "integer",
                          "minimum": 0
                        },
                        "isActive": {
                          "type": "boolean"
                        },
                        "history": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "timestamp": {
                                "type": "number"
                              },
                              "type": {
                                "type": "string"
                              },
                              "data": {},
                              "previousState": {}
                            },
                            "required": [
                              "id",
                              "timestamp",
                              "type"
                            ]
                          }
                        },
                        "mode": {
                          "type": "string",
                          "enum": [
                            "TheatreOfMind",
                            "GridBased"
                          ]
                        },
                        "map": {
                          "type": "object",
                          "properties": {
                            "width": {
                              "type": "integer",
                              "exclusiveMinimum": 0
                            },
                            "height": {
                              "type": "integer",
                              "exclusiveMinimum": 0
                            },
                            "cells": {
                              "type": "array",
                              "items": {
                                "type": "array",
                                "items": {
                                  "type": "object",
                                  "properties": {
                                    "x": {
                                      "type": "integer",
                                      "minimum": 0
                                    },
                                    "y": {
                                      "type": "integer",
                                      "minimum": 0
                                    },
                                    "terrain": {
                                      "type": "string",
                                      "enum": [
                                        "Empty",
                                        "Wall",
                                        "DifficultTerrain",
                                        "Water",
                                        "Pit",
                                        "Door",
                                        "Window",
                                        "Cover",
                                        "HeavyCover",
                                        "Stairs",
                                        "Hazard"
                                      ]
                                    },
                                    "doorOpen": {
                                      "type": "boolean"
                                    },
                                    "elevation": {
                                      "type": "number"
                                    },
                                    "hazardDamage": {
                                      "type": "number"
                                    }
                                  },
                                  "required": [
                                    "x",
                                    "y",
                                    "terrain"
                                  ]
                                }
                              }
                            },
                            "description": {
                              "type": "string"
                            }
                          },
                          "required": [
                            "width",
                            "height",
                            "cells"
                          ]
                        },
                        "sceneDescription": {
                          "type": "string"
                        },
                        "creaturePositions": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "name",
                        "creatures",
                        "currentTurn",
                        "round",
                        "isActive",
                        "history",
                        "mode"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data"
                  ]
                }
              }
            }
          },
          "404": {
            "description": "Battle not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "enum": [
                        false
                      ]
                    },
                    "error": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "success",
                    "error"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/battles/{id}/positions": {
      "put": {
        "tags": [
          "battle",
          "mcp"
        ],
        "summary": "Update creature positions description",
        "description": "Update the narrative description of creature positions (for Theatre of Mind)",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "example": "battle-123"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "positions": {
                    "type": "string"
                  }
                },
                "required": [
                  "positions"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Creature positions description updated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "enum": [
                        true
                      ]
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        },
                        "creatures": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "name": {
                                "type": "string"
                              },
                              "hp": {
                                "type": "integer"
                              },
                              "maxHp": {
                                "type": "integer",
                                "exclusiveMinimum": 0
                              },
                              "ac": {
                                "type": "integer",
                                "minimum": 0
                              },
                              "initiative": {
                                "type": "integer"
                              },
                              "stats": {
                                "type": "object",
                                "properties": {
                                  "str": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "dex": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "con": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "int": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "wis": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  },
                                  "cha": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 30
                                  }
                                },
                                "required": [
                                  "str",
                                  "dex",
                                  "con",
                                  "int",
                                  "wis",
                                  "cha"
                                ]
                              },
                              "statusEffects": {
                                "type": "array",
                                "items": {
                                  "type": "object",
                                  "properties": {
                                    "name": {
                                      "type": "string"
                                    },
                                    "description": {
                                      "type": "string"
                                    },
                                    "duration": {
                                      "type": "number"
                                    },
                                    "concentration": {
                                      "type": "boolean"
                                    }
                                  },
                                  "required": [
                                    "name"
                                  ]
                                }
                              },
                              "position": {
                                "type": "object",
                                "properties": {
                                  "x": {
                                    "type": "integer",
                                    "minimum": 0,
                                    "example": 5
                                  },
                                  "y": {
                                    "type": "integer",
                                    "minimum": 0,
                                    "example": 3
                                  }
                                },
                                "required": [
                                  "x",
                                  "y"
                                ]
                              },
                              "size": {
                                "type": "string",
                                "enum": [
                                  "Tiny",
                                  "Small",
                                  "Medium",
                                  "Large",
                                  "Huge",
                                  "Gargantuan"
                                ]
                              },
                              "isPlayer": {
                                "type": "boolean"
                              }
                            },
                            "required": [
                              "id",
                              "name",
                              "hp",
                              "maxHp",
                              "ac",
                              "initiative",
                              "stats",
                              "statusEffects",
                              "size",
                              "isPlayer"
                            ]
                          }
                        },
                        "currentTurn": {
                          "type": "integer",
                          "minimum": 0
                        },
                        "round": {
                          "type": "integer",
                          "minimum": 0
                        },
                        "isActive": {
                          "type": "boolean"
                        },
                        "history": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "timestamp": {
                                "type": "number"
                              },
                              "type": {
                                "type": "string"
                              },
                              "data": {},
                              "previousState": {}
                            },
                            "required": [
                              "id",
                              "timestamp",
                              "type"
                            ]
                          }
                        },
                        "mode": {
                          "type": "string",
                          "enum": [
                            "TheatreOfMind",
                            "GridBased"
                          ]
                        },
                        "map": {
                          "type": "object",
                          "properties": {
                            "width": {
                              "type": "integer",
                              "exclusiveMinimum": 0
                            },
                            "height": {
                              "type": "integer",
                              "exclusiveMinimum": 0
                            },
                            "cells": {
                              "type": "array",
                              "items": {
                                "type": "array",
                                "items": {
                                  "type": "object",
                                  "properties": {
                                    "x": {
                                      "type": "integer",
                                      "minimum": 0
                                    },
                                    "y": {
                                      "type": "integer",
                                      "minimum": 0
                                    },
                                    "terrain": {
                                      "type": "string",
                                      "enum": [
                                        "Empty",
                                        "Wall",
                                        "DifficultTerrain",
                                        "Water",
                                        "Pit",
                                        "Door",
                                        "Window",
                                        "Cover",
                                        "HeavyCover",
                                        "Stairs",
                                        "Hazard"
                                      ]
                                    },
                                    "doorOpen": {
                                      "type": "boolean"
                                    },
                                    "elevation": {
                                      "type": "number"
                                    },
                                    "hazardDamage": {
                                      "type": "number"
                                    }
                                  },
                                  "required": [
                                    "x",
                                    "y",
                                    "terrain"
                                  ]
                                }
                              }
                            },
                            "description": {
                              "type": "string"
                            }
                          },
                          "required": [
                            "width",
                            "height",
                            "cells"
                          ]
                        },
                        "sceneDescription": {
                          "type": "string"
                        },
                        "creaturePositions": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "name",
                        "creatures",
                        "currentTurn",
                        "round",
                        "isActive",
                        "history",
                        "mode"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data"
                  ]
                }
              }
            }
          },
          "404": {
            "description": "Battle not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "enum": [
                        false
                      ]
                    },
                    "error": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "success",
                    "error"
                  ]
                }
              }
            }
          }
        }
      }
    }
  },
  "webhooks": {}
}